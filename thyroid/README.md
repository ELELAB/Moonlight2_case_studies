
Cancer Systems Biology, Section of Bioinformatics, Department of Health and Technology, Technical University of Denmark, 2800, Lyngby, Copenhagen

# Moonlight2_case_studies

An Automatized Workflow to Study Mechanistic Indicators for Driver Gene Prediction with Moonlight
Astrid Saksager, Mona Nourbakhsh, Nikola Tom, Xi Steven Chen, Antonio Colaprico, Catharina Olsen, Matteo Tiberti, Elena Papaleo*, 
bioRxiv 2022.11.18.517066; doi: https://doi.org/10.1101/2022.11.18.517066

contacts for the repository: Elena Papaleo, elpap-at-dtu.dk, elenap-at-cancer.dk; Astrid Saksager: abrisa-at-dtu.dk

PLEASE, CITE THE PUBLICATION ABOVE IF YOU USE THE SCRIPTS FOR YOUR OWN RESEARCH

This Project-folder contains the entire Thyroid Cancer (THCA) study
AIM: To find driver genes for THCA patients by running Moonlight2 on THCA data from TCGA.

## Installing requirements and reproducing the analysis

All the analyses have been performed on a GNU/Linux server.

NB: When reproducing the analyses and results, the user cannot expect to obtain identical results to the ones
in this GitHub repository and associated with the publication due to stochastic processes in the GRN step of the Moonlight protocol. 

### CScape-somatic

In order to run the analyses you will need to have available the pre-calculated
[CScape-somatic](http://cscape-somatic.biocompute.org.uk) scores. These are
downloadable from CScape-somatic website. Please download the `css_coding.vcf.gz`,
`css_noncoding.vcf.gz`, `css_coding.vcf.gz.tbi` and `css_noncoding.vcf.gz.tbi`
files and store them or link them in the folder of the cancer type
(see step 1 in the following section).

The `Run_Thyroid.sh` script can be optionally modified to set a custom location of
the CScape file. **If this is a relative path, it should start from the `scripts`
directory inside the main folder, since that is where the code is run from.**

### Reproducing the analyses

To prepare the virtual environment for this case study, please see the README
file in the main folder. Then proceed to the following steps:

1. copy or link the CScape-somatic files in the directory of the cancer type
(the following example creates symbolic links - you will need to customize your
paths depending on the location of your folder):

```
ln -s ../../../../databases/CScape/CScape-20210624/css_coding.vcf.gz .
ln -s ../../../../databases/CScape/CScape-20210624/css_coding.vcf.gz.tbi .
ln -s ../../../../databases/CScape/CScape-20210624/css_noncoding.vcf.gz .
ln -s ../../../../databases/CScape/CScape-20210624/css_noncoding.vcf.gz.tbi .
```

2. run the analysis:

```
$ bash ./Run_Thyroid.sh
```

**WARNING**: our script use the [renv](https://rstudio.github.io/renv/articles/renv.html)
R package to handle automatic dependency installation. `Renv` writes packages in
its own cache folder, which is by default in the user's home directory. This might
not be desireable if free space in the home directory is limited as this cache
takes about 2GB for this project. You can change the location of the Renv root
folder by setting a system environment variable - please see comments in the 
`Run_Thyroid.sh` script.

This script will:

1. Install in the environment all the necessary R packages, including Moonlight2R
from [our GitHub repository](https://www.github.com/ELELAB/Moonlight2R)
2. Download from [our OSF repository](https://osf.io/eq9wj/) the `data` folder
that contains data required for the analysis (see below). This takes approximately
700MB of disk space.
3. perform the analysis

## Content of the downloaded directories

### `./data`

This contains the data generated by Moonlight2:
`FEA_Thyroid.rda`, `URA_Thyroid.rda`, `GRN_Thyroid.rda`, `PRA_Thyroid.rda`, `DMA_Thyroid.rda`

### `./data/rawdata`

This data that is not generated in this project, but was used as input to
generate the results. It includes:
  - Mutation from TCGA-THCA (`mutations_THCA.csv`)
  - Differential Gene expression from TCGA-THCA (`THCA_DEGs_NTvs.TP.rda`)
  - Normal counts of gene expression (`THCA_dataFilt_HUGO.rda`)
  - Driver genes predicted by GUST (`GUST_THCA.csv`)
  - List of transcription factors from TRRUST (`trrust_rawdata_human.tsv`)
  - List of human kinases from Kinhub (`kinhub.tsv`)
  - List of PAM50 genes (`pam50_list.txt`)
  - List of dual role driver genes from Shen et al. 2018 (`Shen_dual_genes.txt`)

### `./scripts/`
The script `00_init.R` downloads the raw data from our OSF respository, 
loads and installs the software packages required to run the rest of the scripts,
and performs all the necessary calculations by sourcing a number of other
scripts.

The script are numbered and the results from each are numbered accordingly.

### `./results/`
This folder contains plots and tables used in the paper. The numbers in filenames
refer to the script they are generated from.

## Paper contents

The paper contents corresponds to the following files:

| Figure/Table   | Filename                                              |
| -------------- | ----------------------------------------------------- |
|                |                                                       |
